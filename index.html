<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق التواصل باستخدام Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 500px; margin: auto; }
        input, button, textarea { width: 100%; padding: 10px; margin: 5px 0; }
        .post { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="container">
        <h2>تسجيل الدخول / التسجيل</h2>
        <input type="email" id="email" placeholder="البريد الإلكتروني">
        <input type="password" id="password" placeholder="كلمة المرور">
        <button onclick="register()">تسجيل</button>
        <button onclick="login()">دخول</button>
        
        <h2>إضافة منشور</h2>
        <textarea id="postContent" placeholder="اكتب منشورك هنا"></textarea>
        <button onclick="addPost()">نشر</button>
        
        <h2>المنشورات</h2>
        <div id="posts"></div>
    </div>

    <script>
        // مفاتيح Supabase
        const SUPABASE_URL = "https://xvftfiwrnjbgyvfe.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5c...";
        
        // تهيئة الاتصال مع Supabase
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // إنشاء الجداول تلقائيًا إذا لم تكن موجودة
        async function setupDatabase() {
            try {
                const { data, error } = await supabase
                    .rpc('create_posts_table');

                if (error) {
                    console.error("خطأ أثناء إنشاء الجدول:", error);
                } else {
                    console.log("تم التحقق من الجدول بنجاح!");
                }
            } catch (error) {
                console.error("خطأ في إنشاء القاعدة:", error);
            }
        }

        // تسجيل مستخدم جديد
        async function register() {
            try {
                const { user, error } = await supabase.auth.signUp({
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value
                });

                if (error) throw error;
                alert("تم التسجيل بنجاح!");
            } catch (error) {
                alert("خطأ: " + error.message);
            }
        }

        // تسجيل الدخول
        async function login() {
            try {
                const { user, error } = await supabase.auth.signInWithPassword({
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value
                });

                if (error) throw error;
                alert("تم تسجيل الدخول!");
                getPosts();
            } catch (error) {
                alert("خطأ: " + error.message);
            }
        }

        // إضافة منشور جديد
        async function addPost() {
            try {
                const { data, error } = await supabase
                    .from('posts')
                    .insert([{ content: document.getElementById('postContent').value }]);

                if (error) throw error;
                alert("تم نشر المنشور!");
                getPosts();
            } catch (error) {
                alert("خطأ: " + error.message);
            }
        }

        // جلب جميع المنشورات وعرضها
        async function getPosts() {
            try {
                const { data, error } = await supabase
                    .from('posts')
                    .select('*');

                if (error) throw error;

                document.getElementById('posts').innerHTML = data.map(post => `
                    <div class="post">
                        <p>${post.content}</p>
                        <button onclick="likePost(${post.id})">إعجاب</button>
                        <button onclick="addComment(${post.id})">تعليق</button>
                    </div>
                `).join('');
            } catch (error) {
                alert("خطأ: " + error.message);
            }
        }

        // تسجيل إعجاب بالمنشور
        async function likePost(postId) {
            alert("تم تسجيل الإعجاب بالمنشور " + postId);
        }

        // إضافة تعليق على المنشور
        async function addComment(postId) {
            const comment = prompt("اكتب تعليقك:");
            if (comment) alert("تمت إضافة تعليقك على المنشور " + postId);
        }

        // التأكد من إنشاء الجدول ثم جلب المنشورات
        setupDatabase();
        getPosts();
    </script>

</body>
</html>
