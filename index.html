<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ ØªÙˆØ§ØµÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</title>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; text-align: center; }
        .container { width: 80%; margin: auto; }
        .post { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        .like-btn, .comment-btn { cursor: pointer; color: blue; margin: 5px; }
        #posts { margin-top: 20px; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
        <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        <h3 id="welcome"></h3>

        <h2>Ù†Ø´Ø± Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h2>
        <textarea id="postContent" placeholder="Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ù‹Ø§..."></textarea>
        <input type="file" id="mediaUpload">
        <button onclick="addPost()">Ù†Ø´Ø±</button>

        <h2>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</h2>
        <div id="posts"></div>
    </div>

    <script>
        // Ù…Ø¹Ø±Ù Ù…Ù„Ù JSON Ø¹Ù„Ù‰ Google Drive
        const FILE_ID = "HjZwWx1c7g2dV7U4b62SGODBaWPM9E";  // Ø¶Ø¹ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§
        const DRIVE_URL = `https://drive.google.com/uc?export=download&id=${FILE_ID}`;

        // Ø±Ø§Ø¨Ø· API Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Google Apps Script
        const API_URL = "https://script.google.com/macros/s/AKfycbx.../exec"; // Ø¶Ø¹ Ø±Ø§Ø¨Ø· API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§

        let user = localStorage.getItem("user") || "";
        let posts = [];

        document.getElementById("welcome").innerText = user ? `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ ${user}` : "";

        function login() {
            user = document.getElementById("username").value;
            if (user) {
                localStorage.setItem("user", user);
                document.getElementById("welcome").innerText = `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ ${user}`;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Drive
        async function loadPosts() {
            try {
                let response = await fetch(DRIVE_URL);
                let data = await response.json();
                posts = data.posts;
                renderPosts();
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Google Apps Script API
        async function savePosts() {
            try {
                let response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ posts })
                });
                console.log(await response.text());
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
            }
        }

        function addPost() {
            let content = document.getElementById("postContent").value;
            let file = document.getElementById("mediaUpload").files[0];

            if (!content && !file) return;

            let reader = new FileReader();
            reader.onload = function (e) {
                let post = { user, content, media: file ? e.target.result : null, likes: 0, comments: [] };
                posts.push(post);
                savePosts();
                renderPosts();
            };

            if (file) reader.readAsDataURL(file);
            else reader.onload();
        }

        function renderPosts() {
            let postsContainer = document.getElementById("posts");
            postsContainer.innerHTML = "";

            posts.forEach((post, index) => {
                let postDiv = document.createElement("div");
                postDiv.className = "post";
                postDiv.innerHTML = `
                    <h4>${post.user}</h4>
                    <p>${post.content}</p>
                    ${post.media ? `<img src="${post.media}" width="200">` : ""}
                    <p>
                        â¤ï¸ <span class="like-btn" onclick="likePost(${index})">${post.likes} Ø¥Ø¹Ø¬Ø§Ø¨</span>
                        ğŸ’¬ <span class="comment-btn" onclick="commentPost(${index})">ØªØ¹Ù„ÙŠÙ‚</span>
                    </p>
                    <div id="comments-${index}">${post.comments.map(c => `<p>${c.user}: ${c.text}</p>`).join("")}</div>
                `;
                postsContainer.appendChild(postDiv);
            });
        }

        function likePost(index) {
            posts[index].likes++;
            savePosts();
            renderPosts();
        }

        function commentPost(index) {
            let comment = prompt("Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ:");
            if (!comment) return;
            posts[index].comments.push({ user, text: comment });
            savePosts();
            renderPosts();
        }

        loadPosts();
    </script>

</body>
</html>
