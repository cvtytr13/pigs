<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق تواصل اجتماعي</title>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; text-align: center; }
        .container { width: 80%; margin: auto; }
        .post { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        .like-btn, .comment-btn { cursor: pointer; color: blue; margin: 5px; }
        #posts { margin-top: 20px; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; }
    </style>
</head>
<body>

    <div class="container">
        <h2>تسجيل الدخول / إنشاء حساب</h2>
        <input type="text" id="username" placeholder="اسم المستخدم">
        <button onclick="login()">دخول</button>
        <h3 id="welcome"></h3>

        <h2>نشر منشور جديد</h2>
        <textarea id="postContent" placeholder="اكتب شيئًا..."></textarea>
        <input type="file" id="mediaUpload">
        <button onclick="addPost()">نشر</button>

        <h2>المشاركات</h2>
        <div id="posts"></div>
    </div>

    <script>
        // معرف ملف JSON على Google Drive
        const FILE_ID = "HjZwWx1c7g2dV7U4b62SGODBaWPM9E";  // ضع معرف الملف الحقيقي هنا
        const DRIVE_URL = `https://drive.google.com/uc?export=download&id=${FILE_ID}`;

        // رابط API لتحديث البيانات عبر Google Apps Script
        const API_URL = "https://script.google.com/macros/s/AKfycbx.../exec"; // ضع رابط API الحقيقي هنا

        let user = localStorage.getItem("user") || "";
        let posts = [];

        document.getElementById("welcome").innerText = user ? `مرحبًا، ${user}` : "";

        function login() {
            user = document.getElementById("username").value;
            if (user) {
                localStorage.setItem("user", user);
                document.getElementById("welcome").innerText = `مرحبًا، ${user}`;
            }
        }

        // تحميل البيانات من Google Drive
        async function loadPosts() {
            try {
                let response = await fetch(DRIVE_URL);
                let data = await response.json();
                posts = data.posts;
                renderPosts();
            } catch (error) {
                console.error("خطأ في تحميل البيانات:", error);
            }
        }

        // حفظ البيانات عبر Google Apps Script API
        async function savePosts() {
            try {
                let response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ posts })
                });
                console.log(await response.text());
            } catch (error) {
                console.error("خطأ في حفظ البيانات:", error);
            }
        }

        function addPost() {
            let content = document.getElementById("postContent").value;
            let file = document.getElementById("mediaUpload").files[0];

            if (!content && !file) return;

            let reader = new FileReader();
            reader.onload = function (e) {
                let post = { user, content, media: file ? e.target.result : null, likes: 0, comments: [] };
                posts.push(post);
                savePosts();
                renderPosts();
            };

            if (file) reader.readAsDataURL(file);
            else reader.onload();
        }

        function renderPosts() {
            let postsContainer = document.getElementById("posts");
            postsContainer.innerHTML = "";

            posts.forEach((post, index) => {
                let postDiv = document.createElement("div");
                postDiv.className = "post";
                postDiv.innerHTML = `
                    <h4>${post.user}</h4>
                    <p>${post.content}</p>
                    ${post.media ? `<img src="${post.media}" width="200">` : ""}
                    <p>
                        ❤️ <span class="like-btn" onclick="likePost(${index})">${post.likes} إعجاب</span>
                        💬 <span class="comment-btn" onclick="commentPost(${index})">تعليق</span>
                    </p>
                    <div id="comments-${index}">${post.comments.map(c => `<p>${c.user}: ${c.text}</p>`).join("")}</div>
                `;
                postsContainer.appendChild(postDiv);
            });
        }

        function likePost(index) {
            posts[index].likes++;
            savePosts();
            renderPosts();
        }

        function commentPost(index) {
            let comment = prompt("اكتب تعليقك:");
            if (!comment) return;
            posts[index].comments.push({ user, text: comment });
            savePosts();
            renderPosts();
        }

        loadPosts();
    </script>

</body>
</html>
